!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports):"function"==typeof define&&define.amd?define(["exports"],factory):factory(global.Planck=global.Planck||{})}(this,function(exports){"use strict";function Namespace(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,symbol=Symbol(name);return function namespace(object){var init=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(data){return data};return void 0===object[symbol]&&(object[symbol]=init({})),object[symbol]}}function modifyEvent(event){var scope=internal$1(event);return{set target(value){scope.target=value||null},set currentTarget(value){scope.currentTarget=value||null},set phase(value){scope.phase=value||null}}}function Namespace$1(){var name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,symbol=Symbol(name);return function namespace(object){var init=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(data){return data};return void 0===object[symbol]&&(object[symbol]=init({})),object[symbol]}}function handleInit(event){var scope=internal(this),request=event.target;request.removeEventListener("progress",scope.handlers.init,!1),200===request.status&&(0===scope.size&&setSize(this,event.total),0!==scope.size&&setDeterminate(this,!0))}function handleProgress(event){var scope=internal(this);scope.determinate&&setProgress(this,Math.min(1,event.loaded/scope.size))}function handleLoadend(event){var scope=internal(this),request=event.target;request.removeEventListener("progress",scope.handlers.progress,!1),request.removeEventListener("loadend",scope.handlers.loadend,!1),scope.determinate||setDeterminate(this,!0),200===request.status?(setProgress(this,1),scope.resolve(request),setCompleted(this,!0)):(scope.reject(request.status),setFailed(this,!0))}function setSize(target,value){var scope=internal(target);value!==scope.size&&(scope.size=value,target.dispatchEvent({type:"size",target:target}))}function setProgress(target,value){var scope=internal(target);value!==scope.progress&&(scope.progress=value,target.dispatchEvent({type:"progress",target:target}))}function setDeterminate(target,value){var scope=internal(target);value!==scope.determinate&&(scope.determinate=value,target.dispatchEvent({type:"determinate",target:target}))}function setCompleted(target,value){var scope=internal(target);value!==scope.completed&&(scope.completed=value,target.dispatchEvent({type:"completed",target:target}))}function setFailed(target,value){var scope=internal(target);value!==scope.failed&&(scope.failed=value,target.dispatchEvent({type:"failed",target:target}))}function construct(entries){return entries.map(function(entry){return Array.isArray(entry)?construct(entry):entry&&"function"==typeof entry.load?entry:(entry.url||entry).endsWith(".js")?new ScriptLoader(entry):new DataLoader(entry)})}function expand(entries){return entries.reduce(function(loaders,entry){return Array.isArray(entry)?loaders.concat(expand(entry)):(loaders.push(entry),loaders)},[])}function handleSize(event){this.dispatchEvent({type:"size",target:this})}function handleProgress$1(event){this.dispatchEvent({type:"progress",target:this})}function handleDeterminate(event){updateDeterminate(this)}function handleCompleted(event){updateCompleted(this)}function handleFailed(event){updateFailed(this)}function updateDeterminate(target){var scope=internal$2$1(target),value=scope.loaders.every(function(loader){return loader.determinate});value!==scope.determinate&&(scope.determinate=value,target.dispatchEvent({type:"determinate",target:target}))}function updateCompleted(target){var scope=internal$2$1(target),value=scope.loaders.every(function(loader){return loader.completed});value!==scope.completed&&(scope.completed=value,target.dispatchEvent({type:"completed",target:target}))}function updateFailed(target){var scope=internal$2$1(target),value=scope.loaders.some(function(loader){return loader.failed});value!==scope.failed&&(scope.failed=value,target.dispatchEvent({type:"failed",target:target}),scope.failed&&target.abort())}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)},possibleConstructorReturn=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call},slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)},internal$1=Namespace("Event"),Event=function(){function Event(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};classCallCheck(this,Event),this.init(options)}return createClass(Event,[{key:"init",value:function init(){var _ref2=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},type=_ref2.type,_ref2$captures=_ref2.captures,captures=void 0===_ref2$captures||_ref2$captures,_ref2$bubbles=_ref2.bubbles,bubbles=void 0!==_ref2$bubbles&&_ref2$bubbles,scope=internal$1(this);return scope.type=type||null,scope.captures=!!captures,scope.bubbles=!!bubbles,scope.timestamp=Date.now(),scope.propagationStopped=!1,scope.immediatePropagationStopped=!1,scope.target=null,scope.currentTarget=null,scope.phase=null,this}},{key:"stopPropagation",value:function stopPropagation(){internal$1(this).propagationStopped=!0}},{key:"stopImmediatePropagation",value:function stopImmediatePropagation(){var scope=internal$1(this);scope.propagationStopped=!0,scope.immediatePropagationStopped=!0}},{key:"type",get:function get$$1(){return internal$1(this).type}},{key:"target",get:function get$$1(){return internal$1(this).target}},{key:"currentTarget",get:function get$$1(){return internal$1(this).currentTarget}},{key:"phase",get:function get$$1(){return internal$1(this).phase}},{key:"captures",get:function get$$1(){return internal$1(this).captures}},{key:"bubbles",get:function get$$1(){return internal$1(this).bubbles}},{key:"timestamp",get:function get$$1(){return internal$1(this).timestamp}},{key:"propagationStopped",get:function get$$1(){return internal$1(this).propagationStopped}},{key:"immediatePropagationStopped",get:function get$$1(){return internal$1(this).immediatePropagationStopped}}]),Event}(),_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},objectWithoutProperties$$1=function objectWithoutProperties$$1(obj,keys){var target={};for(var i in obj)keys.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(obj,i)&&(target[i]=obj[i]);return target},CustomEvent=function(_Event){function CustomEvent(){return classCallCheck(this,CustomEvent),possibleConstructorReturn(this,(CustomEvent.__proto__||Object.getPrototypeOf(CustomEvent)).apply(this,arguments))}return inherits(CustomEvent,_Event),createClass(CustomEvent,[{key:"init",value:function init(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},type=_ref.type,target=_ref.target,rest=objectWithoutProperties$$1(_ref,["type","target"]);return get(CustomEvent.prototype.__proto__||Object.getPrototypeOf(CustomEvent.prototype),"init",this).call(this,_extends({},rest,{type:type})),modifyEvent(this).target=target,this}}]),CustomEvent}(Event),internal$1$1=Namespace("EventBundle"),EventBundle=function(_Event2){function EventBundle(){return classCallCheck(this,EventBundle),possibleConstructorReturn(this,(EventBundle.__proto__||Object.getPrototypeOf(EventBundle)).apply(this,arguments))}return inherits(EventBundle,_Event2),createClass(EventBundle,[{key:"init",value:function init(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},originalEvent=_ref.originalEvent,rest=objectWithoutProperties$$1(_ref,["originalEvent"]);return get(EventBundle.prototype.__proto__||Object.getPrototypeOf(EventBundle.prototype),"init",this).call(this,_extends({},rest)),internal$1$1(this).originalEvent=originalEvent,this}},{key:"preventDefault",value:function preventDefault(){internal$1$1(this).originalEvent.preventDefault()}},{key:"defaultPrevented",get:function get$$1(){return internal$1$1(this).originalEvent.defaultPrevented}},{key:"originalEvent",get:function get$$1(){return internal$1$1(this).originalEvent}}]),EventBundle}(Event),GenericEvent=function(_CustomEvent){function GenericEvent(){return classCallCheck(this,GenericEvent),possibleConstructorReturn(this,(GenericEvent.__proto__||Object.getPrototypeOf(GenericEvent)).apply(this,arguments))}return inherits(GenericEvent,_CustomEvent),createClass(GenericEvent,[{key:"init",value:function init(){var _this4=this,_ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},type=_ref.type,target=_ref.target,rest=objectWithoutProperties$$1(_ref,["type","target"]);return get(GenericEvent.prototype.__proto__||Object.getPrototypeOf(GenericEvent.prototype),"init",this).call(this,{type:type,target:target,captures:!1,bubbles:!1}),Object.entries(rest).forEach(function(entry){var _entry=slicedToArray(entry,2),property=_entry[0],value=_entry[1];if({}.hasOwnProperty.call(_this4,property))throw new Error('Name "'+property+'" cannot be used for event property');_this4[property]=value}),this}}]),GenericEvent}(CustomEvent),internal$2=Namespace("EventDispatcher"),EventDispatcher=function(){function EventDispatcher(){classCallCheck(this,EventDispatcher),internal$2(this).listeners={}}return createClass(EventDispatcher,[{key:"addEventListener",value:function addEventListener(type,listener){var capture=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("function"!=typeof listener&&"object"!==(void 0===listener?"undefined":_typeof(listener)))throw new Error("Attempt to add non-function non-object listener");var scope=internal$2(this);void 0===scope.listeners[type]&&(scope.listeners[type]={bubble:[],capture:[]});var listeners=capture?scope.listeners[type].capture:scope.listeners[type].bubble;listeners.includes(listener)||listeners.push(listener)}},{key:"removeEventListener",value:function removeEventListener(type,listener){var capture=arguments.length>2&&void 0!==arguments[2]&&arguments[2],scope=internal$2(this);if(void 0!==scope.listeners[type]){var listeners=capture?scope.listeners[type].capture:scope.listeners[type].bubble,index=listeners.indexOf(listener);-1!==index&&listeners.splice(index,1)}}},{key:"dispatchEvent",value:function dispatchEvent(object){var _this5=this,event=object;event instanceof Event||(event=new GenericEvent(object));var scope=internal$2(this),listeners=scope.listeners[event.type];if(void 0!==listeners){var phase=event.phase;phase&&"target"!==phase&&"capture"!==phase||[].concat(toConsumableArray(listeners.capture)).some(function(listener){if("function"==typeof listener)listener.call(_this5,event);else{if("function"!=typeof listener.handleEvent)throw new Error("Listener is neither function nor event listener");listener.handleEvent(event)}return event.immediatePropagationStopped}),event.immediatePropagationStopped||phase&&"target"!==phase&&"bubble"!==phase||[].concat(toConsumableArray(listeners.bubble)).some(function(listener){return"function"==typeof listener?listener.call(_this5,event):"function"==typeof listener.handleEvent&&listener.handleEvent(event),event.immediatePropagationStopped})}}}]),EventDispatcher}(),internal$3=Namespace("EventTarget"),EventTarget=function(_EventDispatcher){function EventTarget(){classCallCheck(this,EventTarget);var _this6=possibleConstructorReturn(this,(EventTarget.__proto__||Object.getPrototypeOf(EventTarget)).call(this)),scope=internal$3(_this6);return scope.ancestorEventTarget=null,scope.descendantEventTarget=null,_this6}return inherits(EventTarget,_EventDispatcher),createClass(EventTarget,[{key:"determinePropagationPath",value:function determinePropagationPath(){var target=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,path=[];if(null!==target&&void 0!==target)for(var ancestor=target;null!==ancestor&&void 0!==ancestor;)path.unshift(ancestor),ancestor=ancestor.ancestorEventTarget;else for(var descendant=this;null!==descendant&&void 0!==descendant;)path.push(descendant),descendant=descendant.descendantEventTarget;return path}},{key:"dispatchImmediateEvent",value:function dispatchImmediateEvent(event){get(EventTarget.prototype.__proto__||Object.getPrototypeOf(EventTarget.prototype),"dispatchEvent",this).call(this,event)}},{key:"dispatchEvent",value:function dispatchEvent(object){var propagationPath=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,event=object;if(event instanceof Event||(event=new GenericEvent(object)),!event.captures&&!event.bubbles)return void this.dispatchImmediateEvent(event);var capturingPath=void 0;null!==propagationPath&&void 0!==propagationPath?capturingPath=[].concat(toConsumableArray(propagationPath)):event.target&&(capturingPath=this.determinePropagationPath(event.target));var modifier=modifyEvent(event);null===event.target?modifier.target=capturingPath.pop():capturingPath.pop();var bubblingPath=[].concat(toConsumableArray(capturingPath));bubblingPath.reverse(),event.captures&&(modifier.phase="capture",capturingPath.some(function(object){return modifier.currentTarget=object,event.currentTarget.dispatchImmediateEvent(event),event.propagationStopped})),event.propagationStopped||!Number.isInteger(event.target)&&(modifier.phase="target",modifier.currentTarget=event.target,event.currentTarget.dispatchImmediateEvent(event),event.propagationStopped)||event.bubbles&&(modifier.phase="bubble",bubblingPath.some(function(object){return modifier.currentTarget=object,event.currentTarget.dispatchImmediateEvent(event),event.propagationStopped}))}},{key:"ancestorEventTarget",get:function get$$1(){return internal$3(this).ancestorEventTarget},set:function set$$1(value){internal$3(this).ancestorEventTarget=value||null}},{key:"descendantEventTarget",get:function get$$1(){return internal$3(this).descendantEventTarget},set:function set$$1(value){internal$3(this).descendantEventTarget=value||null}}]),EventTarget}(EventDispatcher),KeyboardEvent=function(_EventBundle){function KeyboardEvent(){return classCallCheck(this,KeyboardEvent),possibleConstructorReturn(this,(KeyboardEvent.__proto__||Object.getPrototypeOf(KeyboardEvent)).apply(this,arguments))}return inherits(KeyboardEvent,_EventBundle),createClass(KeyboardEvent,[{key:"init",value:function init(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},rest=objectWithoutProperties$$1(_ref,[]);return get(KeyboardEvent.prototype.__proto__||Object.getPrototypeOf(KeyboardEvent.prototype),"init",this).call(this,_extends({},rest)),this}},{key:"key",get:function get$$1(){return this.originalEvent.key}},{key:"code",get:function get$$1(){return this.originalEvent.code}},{key:"ctrlKey",get:function get$$1(){return this.originalEvent.ctrlKey}},{key:"shiftKey",get:function get$$1(){return this.originalEvent.shiftKey}},{key:"altKey",get:function get$$1(){return this.originalEvent.altKey}},{key:"metaKey",get:function get$$1(){return this.originalEvent.metaKey}},{key:"repeat",get:function get$$1(){return this.originalEvent.repeat}}]),KeyboardEvent}(EventBundle),internal$4=Namespace("MouseEvent"),MouseEvent=function(_EventBundle2){function MouseEvent(){return classCallCheck(this,MouseEvent),possibleConstructorReturn(this,(MouseEvent.__proto__||Object.getPrototypeOf(MouseEvent)).apply(this,arguments))}return inherits(MouseEvent,_EventBundle2),createClass(MouseEvent,[{key:"init",value:function init(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},x=_ref.x,y=_ref.y,movementX=_ref.movementX,movementY=_ref.movementY,rest=objectWithoutProperties$$1(_ref,["x","y","movementX","movementY"]);get(MouseEvent.prototype.__proto__||Object.getPrototypeOf(MouseEvent.prototype),"init",this).call(this,_extends({},rest));var scope=internal$4(this);return scope.x=x,scope.y=y,scope.movementX=movementX,scope.movementY=movementY,this}},{key:"x",get:function get$$1(){return internal$4(this).x}},{key:"y",get:function get$$1(){return internal$4(this).y}},{key:"movementX",get:function get$$1(){return internal$4(this).movementX}},{key:"movementY",get:function get$$1(){return internal$4(this).movementY}},{key:"button",get:function get$$1(){return this.originalEvent.button}},{key:"ctrlKey",get:function get$$1(){return this.originalEvent.ctrlKey}},{key:"shiftKey",get:function get$$1(){return this.originalEvent.shiftKey}},{key:"altKey",get:function get$$1(){return this.originalEvent.altKey}},{key:"metaKey",get:function get$$1(){return this.originalEvent.metaKey}}]),MouseEvent}(EventBundle),internal$5=Namespace("Touch"),Touch=function(){function Touch(){classCallCheck(this,Touch),this.init.apply(this,arguments)}return createClass(Touch,[{key:"init",value:function init(){var _ref3=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},x=_ref3.x,y=_ref3.y,target=_ref3.target,originalTouch=_ref3.originalTouch,scope=internal$5(this);return scope.x=x,scope.y=y,scope.target=target,scope.originalTouch=originalTouch,this}},{key:"identifier",get:function get$$1(){return this.originalTouch.identifier}},{key:"x",get:function get$$1(){return internal$5(this).x}},{key:"y",get:function get$$1(){return internal$5(this).y}},{key:"target",get:function get$$1(){return internal$5(this).target}},{key:"originalTouch",get:function get$$1(){return internal$5(this).originalTouch}}]),Touch}(),internal$6=Namespace("TouchEvent"),TouchEvent=function(_EventBundle3){function TouchEvent(){return classCallCheck(this,TouchEvent),possibleConstructorReturn(this,(TouchEvent.__proto__||Object.getPrototypeOf(TouchEvent)).apply(this,arguments))}return inherits(TouchEvent,_EventBundle3),createClass(TouchEvent,[{key:"init",value:function init(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},touches=_ref.touches,changedTouches=_ref.changedTouches,rest=objectWithoutProperties$$1(_ref,["touches","changedTouches"]);get(TouchEvent.prototype.__proto__||Object.getPrototypeOf(TouchEvent.prototype),"init",this).call(this,_extends({},rest));var scope=internal$6(this);return scope.touches=touches,scope.changedTouches=changedTouches,this}},{key:"touches",get:function get$$1(){return internal$6(this).touches}},{key:"changedTouches",get:function get$$1(){return internal$6(this).changedTouches}},{key:"ctrlKey",get:function get$$1(){return this.originalEvent.ctrlKey}},{key:"shiftKey",get:function get$$1(){return this.originalEvent.shiftKey}},{key:"altKey",get:function get$$1(){return this.originalEvent.altKey}},{key:"metaKey",get:function get$$1(){return this.originalEvent.metaKey}}]),TouchEvent}(EventBundle),TouchList=function(_Array){function TouchList(){classCallCheck(this,TouchList);var _this10=possibleConstructorReturn(this,(TouchList.__proto__||Object.getPrototypeOf(TouchList)).call(this));return _this10.init.apply(_this10,arguments),_this10}return inherits(TouchList,_Array),createClass(TouchList,[{key:"init",value:function init(first){if(this.length=0,first instanceof TouchList)this.push.apply(this,toConsumableArray(first));else{for(var _len=arguments.length,rest=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)rest[_key-1]=arguments[_key];this.push.apply(this,[first].concat(rest))}}},{key:"item",value:function item(index){return this[index]}}]),TouchList}(Array),WheelEvent=function(_MouseEvent){function WheelEvent(){return classCallCheck(this,WheelEvent),possibleConstructorReturn(this,(WheelEvent.__proto__||Object.getPrototypeOf(WheelEvent)).apply(this,arguments))}return inherits(WheelEvent,_MouseEvent),createClass(WheelEvent,[{key:"init",value:function init(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},rest=objectWithoutProperties$$1(_ref,[]);return get(WheelEvent.prototype.__proto__||Object.getPrototypeOf(WheelEvent.prototype),"init",this).call(this,_extends({},rest,{type:"wheel"})),this}},{key:"deltaX",get:function get$$1(){return this.originalEvent.deltaX}},{key:"deltaY",get:function get$$1(){return this.originalEvent.deltaY}},{key:"deltaZ",get:function get$$1(){return this.originalEvent.deltaZ}}]),WheelEvent}(MouseEvent),internal=Namespace$1("DataLoader"),DataLoader=function(_EventDispatcher){function DataLoader(target){classCallCheck(this,DataLoader);var _this=possibleConstructorReturn(this,(DataLoader.__proto__||Object.getPrototypeOf(DataLoader)).call(this)),scope=internal(_this);return scope.request=null,void 0!==target?(scope.url=target.url||target,scope.size=target.size||0):(scope.url=null,scope.size=0),scope.progress=0,scope.determinate=!1,scope.completed=!1,scope.failed=!1,_this}return inherits(DataLoader,_EventDispatcher),createClass(DataLoader,[{key:"load",value:function load(){var _this2=this,scope=internal(this);return void 0!==scope.promise?scope.promise:null===this.url?Promise.reject():(scope.promise=new Promise(function(resolve,reject){var request=new XMLHttpRequest;scope.handlers={init:handleInit.bind(_this2),progress:handleProgress.bind(_this2),loadend:handleLoadend.bind(_this2)},request.addEventListener("progress",scope.handlers.init,!1),request.addEventListener("progress",scope.handlers.progress,!1),request.addEventListener("loadend",scope.handlers.loadend,!1),request.open("get",_this2.url),request.send(),scope.request=request,scope.resolve=resolve,scope.reject=reject}),scope.promise)}},{key:"abort",value:function abort(){var scope=internal(this);void 0!==scope.promise&&scope.request.abort()}},{key:"request",get:function get$$1(){return internal(this).request}},{key:"url",get:function get$$1(){return internal(this).url}},{key:"size",get:function get$$1(){return internal(this).size}},{key:"progress",get:function get$$1(){return internal(this).progress}},{key:"determinate",get:function get$$1(){return internal(this).determinate}},{key:"completed",get:function get$$1(){return internal(this).completed}},{key:"failed",get:function get$$1(){return internal(this).failed}}]),DataLoader}(EventDispatcher),internal$3$1=Namespace$1("ScriptLoader"),ScriptLoader=function(_DataLoader){function ScriptLoader(){return classCallCheck(this,ScriptLoader),possibleConstructorReturn(this,(ScriptLoader.__proto__||Object.getPrototypeOf(ScriptLoader)).apply(this,arguments))}return inherits(ScriptLoader,_DataLoader),createClass(ScriptLoader,[{key:"load",value:function load(){var _this2=this,scope=internal$3$1(this);return void 0!==scope.promise?scope.promise:(scope.promise=new Promise(function(resolve,reject){get(ScriptLoader.prototype.__proto__||Object.getPrototypeOf(ScriptLoader.prototype),"load",_this2).call(_this2).then(function(request){var script=document.createElement("script");script.type="text/javascript",script.src=_this2.url,script.onload=function(){resolve(request)},script.onerror=function(){reject(request.status)};var scripts=document.getElementsByTagName("script"),target=scripts[scripts.length-1];target.parentNode.insertBefore(script,target)})}),scope.promise)}}]),ScriptLoader}(DataLoader),internal$2$1=Namespace$1("Loader"),Loader=function(_EventDispatcher){function Loader(){classCallCheck(this,Loader);var _this=possibleConstructorReturn(this,(Loader.__proto__||Object.getPrototypeOf(Loader)).call(this)),scope=internal$2$1(_this);scope.determinate=!1,scope.completed=!1,scope.failed=!1,scope.handlers={size:handleSize.bind(_this),progress:handleProgress$1.bind(_this),determinate:handleDeterminate.bind(_this),completed:handleCompleted.bind(_this),failed:handleFailed.bind(_this)};for(var _len=arguments.length,sequence=Array(_len),_key=0;_key<_len;_key++)sequence[_key]=arguments[_key];return scope.sequence=construct(sequence),scope.loaders=expand(scope.sequence),scope.loaders.forEach(function(loader){loader.addEventListener("size",scope.handlers.size,!1),loader.addEventListener("progress",scope.handlers.progress,!1),loader.addEventListener("determinate",scope.handlers.determinate,!1),loader.addEventListener("completed",scope.handlers.completed,!1),loader.addEventListener("failed",scope.handlers.failed,!1)}),_this}return inherits(Loader,_EventDispatcher),createClass(Loader,[{key:"load",value:function load(){var scope=internal$2$1(this);return void 0!==scope.promise?scope.promise:0===this.loaders.length?Promise.reject():(scope.promise=this.constructor.loadSequentially(scope.sequence),scope.promise)}},{key:"abort",value:function abort(){var scope=internal$2$1(this);void 0!==scope.promise&&scope.loaders.forEach(function(loader){loader.abort()})}},{key:"loaders",get:function get$$1(){var scope=internal$2$1(this);return[].concat(toConsumableArray(scope.loaders))}},{key:"size",get:function get$$1(){return internal$2$1(this).loaders.reduce(function(size,loader){return size+loader.size},0)}},{key:"progress",get:function get$$1(){var scope=internal$2$1(this);if(0===this.size)return Math.min(1,scope.loaders.reduce(function(progress,loader){return progress+loader.progress/scope.loaders.length},0));var loaders=scope.loaders.filter(function(loader){return 0!==loader.size}),mean=loaders.reduce(function(sum,loader){return sum+loader.size},0)/loaders.length,total=mean*scope.loaders.length;return Math.min(1,scope.loaders.reduce(function(progress,loader){return progress+loader.progress*(loader.size||mean)/total},0))}},{key:"determinate",get:function get$$1(){return internal$2$1(this).determinate}},{key:"completed",get:function get$$1(){return internal$2$1(this).completed}},{key:"failed",get:function get$$1(){return internal$2$1(this).failed}}],[{key:"loadParallelly",value:function loadParallelly(loaders){var _this2=this;return Promise.all(loaders.map(function(loader){return Array.isArray(loader)?_this2.loadSequentially(loader):loader.load().then(function(request){return[].concat(request)})})).then(function(requests){var _ref;return(_ref=[]).concat.apply(_ref,toConsumableArray(requests))})}},{key:"loadSequentially",value:function loadSequentially(loaders){var _this3=this;return 0===loaders.length?Promise.resolve([]):loaders.reduce(function(promise,loader){return null===promise?Array.isArray(loader)?_this3.loadParallelly(loader):loader.load().then(function(request){return[].concat(request)}):Array.isArray(loader)?promise.then(function(requests){return _this3.loadParallelly(loader).then(function(request){return[].concat(requests,request)})}):promise.then(function(requests){return loader.load().then(function(request){return[].concat(requests,request)})})},null)}}]),Loader}(EventDispatcher);exports.DataLoader=DataLoader,exports.Loader=Loader,exports.ScriptLoader=ScriptLoader,Object.defineProperty(exports,"__esModule",{value:!0})});