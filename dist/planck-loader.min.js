!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Planck=e.Planck||{})}(this,function(e){"use strict";function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=Symbol(e);return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};return void 0===e[t]&&(e[t]=n({})),e[t]}}function n(e){var t=H(e);return{set target(e){t.target=void 0!==e?e:null},set currentTarget(e){t.currentTarget=void 0!==e?e:null},set eventPhase(e){t.eventPhase=void 0!==e?e:null}}}function r(e,t){if("function"==typeof t)t(e);else{if("function"!=typeof t.handleEvent)throw new Error("Listener is neither function nor event listener");t.handleEvent(e)}}function o(e,t){var n=U(e);t!==n.size&&(n.size=t,e.dispatchEvent({type:"size",target:e}))}function i(e,t){var n=U(e);t!==n.progress&&(n.progress=t,e.dispatchEvent({type:"progress",target:e}))}function a(e,t){var n=U(e);t!==n.determinate&&(n.determinate=t,e.dispatchEvent({type:"determinate",target:e}))}function u(e,t){var n=U(e);t!==n.completed&&(n.completed=t,e.dispatchEvent({type:"completed",target:e}))}function s(e,t){var n=U(e);t!==n.failed&&(n.failed=t,e.dispatchEvent({type:"failed",target:e}))}function c(e){var t=U(this),n=e.target;n.removeEventListener("progress",t.handlers.init,!1),200===n.status&&(0===t.size&&o(this,e.total),0!==t.size&&a(this,!0))}function l(e){var t=U(this);t.determinate&&i(this,Math.min(1,e.loaded/t.size))}function f(e){var t=U(this),n=e.target;n.removeEventListener("progress",t.handlers.progress,!1),n.removeEventListener("loadend",t.handlers.loadend,!1),t.determinate||a(this,!0),200===n.status?(i(this,1),t.resolve(n),u(this,!0)):(t.reject(n.status),s(this,!0))}function p(e){return e.map(function(e){return Array.isArray(e)?p(e):e&&"function"==typeof e.load?e:(e.url||e).endsWith(".js")?new Z(e):new V(e)})}function d(e){return e.reduce(function(e,t){return Array.isArray(t)?e.concat(d(t)):(e.push(t),e)},[])}function h(e){var t=$(e),n=t.loaders.every(function(e){return e.determinate});n!==t.determinate&&(t.determinate=n,e.dispatchEvent({type:"determinate",target:e}))}function v(e){var t=$(e),n=t.loaders.every(function(e){return e.completed});n!==t.completed&&(t.completed=n,e.dispatchEvent({type:"completed",target:e}))}function y(e){var t=$(e),n=t.loaders.some(function(e){return e.failed});n!==t.failed&&(t.failed=n,e.dispatchEvent({type:"failed",target:e}),t.failed&&e.abort())}function g(e){this.dispatchEvent({type:"size",target:this})}function m(e){this.dispatchEvent({type:"progress",target:this})}function b(e){h(this)}function k(e){v(this)}function P(e){y(this)}var w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_=(function(){function e(e){this.value=e}function t(t){function n(o,i){try{var a=t[o](i),u=a.value;u instanceof e?Promise.resolve(u.value).then(function(e){n("next",e)},function(e){n("throw",e)}):r(a.done?"return":"normal",a.value)}catch(e){r("throw",e)}}function r(e,t){switch(e){case"return":o.resolve({value:t,done:!0});break;case"throw":o.reject(t);break;default:o.resolve({value:t,done:!1})}(o=o.next)?n(o.key,o.arg):i=null}var o,i;this._invoke=function(e,t){return new Promise(function(r,a){var u={key:e,arg:t,resolve:r,reject:a,next:null};i?i=i.next=u:(o=i=u,n(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),O=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},j=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},S=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},L=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},z=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},A=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},x=Symbol("_cachedApplicationRef"),q=Symbol("_mixinRef"),T=Symbol("_originalMixin"),M=function(e,t){return Object.setPrototypeOf(t,e),e[T]||(e[T]=e),t},D=function(e){return M(e,function(t){var n=e[x];if(n||(n=e[x]=Symbol(e.name)),t.hasOwnProperty(n))return t[n];var r=e(t);return t[n]=r,r})},I=function(e){return Symbol.hasInstance&&!e.hasOwnProperty(Symbol.hasInstance)&&Object.defineProperty(e,Symbol.hasInstance,{value:function(e){for(var t=this[T];null!=e;){if(e.hasOwnProperty(q)&&e[q]===t)return!0;e=Object.getPrototypeOf(e)}return!1}}),e},F=function(e){return M(e,function(t){var n=e(t);return n.prototype[q]=e[T],n})},R=function(){function e(t){_(this,e),this.superclass=t}return O(e,[{key:"with",value:function(){return Array.from(arguments).reduce(function(e,t){return t(e)},this.superclass)}}]),e}(),N=function(){try{if(new Function("return this === window")())return"browser"}catch(e){}try{if(new Function("return this === self")())return"worker"}catch(e){}try{if(new Function("return this === global")())return"node"}catch(e){}}(),B=void 0;switch(N){case"browser":B=window;break;case"worker":B=self;break;case"node":B=global}var C={type:N,self:B},H=t("Event"),W=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_(this,e),this.init(t)}return O(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=e.captures,r=void 0!==n&&n,o=e.bubbles,i=void 0===o||o,a=e.cancelable,u=void 0===a||a,s=H(this);return s.type=void 0!==t?t:null,s.captures=!!r,s.bubbles=!!i,s.cancelable=!!u,s.timeStamp=C.self.performance&&C.self.performance.now&&C.self.performance.now()||Date.now(),s.propagationStopped=!1,s.immediatePropagationStopped=!1,s.defaultPrevented=!1,s.target=null,s.currentTarget=null,s.eventPhase=null,this}},{key:"stopPropagation",value:function(){H(this).propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){var e=H(this);e.propagationStopped=!0,e.immediatePropagationStopped=!0}},{key:"preventDefault",value:function(){this.cancelable&&(H(this).defaultPrevented=!0)}},{key:"type",get:function(){return H(this).type}},{key:"target",get:function(){return H(this).target}},{key:"currentTarget",get:function(){return H(this).currentTarget}},{key:"eventPhase",get:function(){return H(this).eventPhase}},{key:"captures",get:function(){return H(this).captures}},{key:"bubbles",get:function(){return H(this).bubbles}},{key:"cancelable",get:function(){return H(this).cancelable}},{key:"timeStamp",get:function(){return H(this).timeStamp}},{key:"propagationStopped",get:function(){return H(this).propagationStopped}},{key:"immediatePropagationStopped",get:function(){return H(this).immediatePropagationStopped}},{key:"defaultPrevented",get:function(){return H(this).defaultPrevented}}]),e}(),X=function(e){function t(){return _(this,t),z(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return S(t,W),O(t,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.type,o=e.target,i=L(e,["type","target"]);return j(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,E({type:r},i)),n(this).target=void 0!==o?o:null,this}}]),t}(),G=function(e){function t(){return _(this,t),z(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return S(t,X),O(t,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.type,r=e.target,o=e.captures,i=void 0!==o&&o,a=e.bubbles,u=void 0!==a&&a,s=L(e,["type","target","captures","bubbles"]);j(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,{type:n,target:r,captures:i,bubbles:u});for(var c=Object.keys(s),l=0;l<c.length;++l){var f=c[l];if({}.hasOwnProperty.call(this,f))throw new Error('Name "'+f+'" cannot be used for event property');this[f]=s[f]}return this}}]),t}(),J=t("EventDispatcherMixin"),K=function(e){return D(I(F(e)))}(function(e){return function(t){function o(){var e;_(this,o);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=z(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(n)));return J(i).listeners={},i}return S(o,e),O(o,[{key:"addEventListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("function"!=typeof t&&"object"!==(void 0===t?"undefined":w(t)))throw new Error("Attempt to add non-function non-object listener");var r=J(this);void 0===r.listeners[e]&&(r.listeners[e]={bubble:[],capture:[]});var o=n?r.listeners[e].capture:r.listeners[e].bubble;o.includes(t)||o.push(t)}},{key:"removeEventListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=J(this);if(void 0!==r.listeners[e]){var o=n?r.listeners[e].capture:r.listeners[e].bubble,i=o.indexOf(t);-1!==i&&o.splice(i,1)}}},{key:"on",value:function(){return this.addEventListener.apply(this,arguments),this}},{key:"off",value:function(){return this.removeEventListener.apply(this,arguments),this}},{key:"once",value:function(e,t){for(var n=arguments.length,o=Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];var a=this;return this.addEventListener.apply(this,[e,function n(i){r(i,t),a.removeEventListener.apply(a,[e,n].concat(o))}].concat(o)),this}},{key:"dispatchEvent",value:function(e){var t=e;t instanceof W||(t=new G(e));var o=n(t);null===t.target&&(o.target=this),o.currentTarget=this;var i=J(this).listeners[t.type];if(void 0!==i){var a=t.eventPhase;if(!a||"target"===a||"capture"===a)for(var u=0;u<i.capture.length;++u)if(r(t,i.capture[u]),t.immediatePropagationStopped)return;if(!a||"target"===a||"bubble"===a)for(var s=0;s<i.bubble.length;++s)if(r(t,i.bubble[s]),t.immediatePropagationStopped)return}}}]),o}()}),Q=function(e){function t(){return _(this,t),z(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return S(t,e),t}(function(e){return new R(e)}(function(){function e(){_(this,e)}return e}()).with(K)),U=t("DataLoader"),V=function(e){function t(e){_(this,t);var n=z(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=U(n);return r.request=null,void 0!==e?(r.url=e.url||e,r.size=e.size||0):(r.url=null,r.size=0),r.progress=0,r.determinate=!1,r.completed=!1,r.failed=!1,n}return S(t,Q),O(t,[{key:"load",value:function(){var e=this,t=U(this);return void 0!==t.promise?t.promise:null===this.url?Promise.reject(new Error("Attempt to load without is not set")):(t.promise=new Promise(function(n,r){var o=new XMLHttpRequest;t.handlers={init:c.bind(e),progress:l.bind(e),loadend:f.bind(e)},o.addEventListener("progress",t.handlers.init,!1),o.addEventListener("progress",t.handlers.progress,!1),o.addEventListener("loadend",t.handlers.loadend,!1),o.open("get",e.url),o.send(),t.request=o,t.resolve=n,t.reject=r}),t.promise)}},{key:"abort",value:function(){var e=U(this);void 0!==e.promise&&e.request.abort()}},{key:"request",get:function(){return U(this).request}},{key:"url",get:function(){return U(this).url}},{key:"size",get:function(){return U(this).size}},{key:"progress",get:function(){return U(this).progress}},{key:"determinate",get:function(){return U(this).determinate}},{key:"completed",get:function(){return U(this).completed}},{key:"failed",get:function(){return U(this).failed}}]),t}(),Y=t("ScriptLoader"),Z=function(e){function t(){return _(this,t),z(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return S(t,V),O(t,[{key:"load",value:function(){var e=this,n=Y(this);return void 0!==n.promise?n.promise:(n.promise=new Promise(function(n,r){j(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"load",e).call(e).then(function(t){var o=document.createElement("script");o.type="text/javascript",o.src=e.url,o.onload=function(){n(t)},o.onerror=function(){r(t.status)};var i=document.getElementsByTagName("script"),a=i[i.length-1];a.parentNode.insertBefore(o,a)})}),n.promise)}}]),t}(),$=t("Loader"),ee=function(e){function t(){_(this,t);var e=z(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n=$(e);n.determinate=!1,n.completed=!1,n.failed=!1,n.handlers={size:g.bind(e),progress:m.bind(e),determinate:b.bind(e),completed:k.bind(e),failed:P.bind(e)};for(var r=arguments.length,o=Array(r),i=0;i<r;i++)o[i]=arguments[i];return n.sequence=p(o),n.loaders=d(n.sequence),n.loaders.forEach(function(e){e.addEventListener("size",n.handlers.size,!1),e.addEventListener("progress",n.handlers.progress,!1),e.addEventListener("determinate",n.handlers.determinate,!1),e.addEventListener("completed",n.handlers.completed,!1),e.addEventListener("failed",n.handlers.failed,!1)}),e}return S(t,Q),O(t,[{key:"load",value:function(){var e=$(this);return void 0!==e.promise?e.promise:0===this.loaders.length?Promise.reject():(e.promise=this.constructor.loadSequentially(e.sequence),e.promise)}},{key:"abort",value:function(){var e=$(this);void 0!==e.promise&&e.loaders.forEach(function(e){e.abort()})}},{key:"loaders",get:function(){var e=$(this);return[].concat(A(e.loaders))}},{key:"size",get:function(){return $(this).loaders.reduce(function(e,t){return e+t.size},0)}},{key:"progress",get:function(){var e=$(this);if(0===this.size)return Math.min(1,e.loaders.reduce(function(t,n){return t+n.progress/e.loaders.length},0));var t=e.loaders.filter(function(e){return 0!==e.size}),n=t.reduce(function(e,t){return e+t.size},0)/t.length,r=n*e.loaders.length;return Math.min(1,e.loaders.reduce(function(e,t){return e+t.progress*(t.size||n)/r},0))}},{key:"determinate",get:function(){return $(this).determinate}},{key:"completed",get:function(){return $(this).completed}},{key:"failed",get:function(){return $(this).failed}}],[{key:"loadParallelly",value:function(e){var t=this;return Promise.all(e.map(function(e){return Array.isArray(e)?t.loadSequentially(e):e.load().then(function(e){return[].concat(e)})})).then(function(e){var t;return(t=[]).concat.apply(t,A(e))})}},{key:"loadSequentially",value:function(e){var t=this;return 0===e.length?Promise.resolve([]):e.reduce(function(e,n){return null===e?Array.isArray(n)?t.loadParallelly(n):n.load().then(function(e){return[].concat(e)}):Array.isArray(n)?e.then(function(e){return t.loadParallelly(n).then(function(t){return[].concat(e,t)})}):e.then(function(e){return n.load().then(function(t){return[].concat(e,t)})})},null)}}]),t}();e.DataLoader=V,e.Loader=ee,e.ScriptLoader=Z,Object.defineProperty(e,"__esModule",{value:!0})});