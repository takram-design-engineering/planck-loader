!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Planck=e.Planck||{})}(this,function(e){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},s=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},c=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},l=Symbol("_cachedApplicationRef"),p=Symbol("_mixinRef"),f=Symbol("_originalMixin"),d=function(e,t){return Object.setPrototypeOf(t,e),e[f]||(e[f]=e),t},h=function(){function e(t){n(this,e),this.superclass=t}return r(e,[{key:"with",value:function(){return Array.from(arguments).reduce(function(e,t){return t(e)},this.superclass)}}]),e}();function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=Symbol(e);return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};return void 0===e[t]&&(e[t]=n({})),e[t]}}var y=function(){try{if(new Function("return this === window")())return!0}catch(e){}return!1}(),g=!y&&function(){try{if(new Function("return this === self")())return!0}catch(e){}return!1}(),m=!y&&!g&&function(){try{if(new Function("return this === global")())return!0}catch(e){}return!1}(),b=y?window:g?self:m?global:void 0,P={isBrowser:y,isWorker:g,isNode:m,scope:b},k=v("Event"),E=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),this.init(t)}return r(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=e.captures,r=void 0!==n&&n,o=e.bubbles,i=void 0===o||o,a=e.cancelable,s=void 0===a||a,u=k(this);return u.type=void 0!==t?t:null,u.captures=!!r,u.bubbles=!!i,u.cancelable=!!s,u.timeStamp=P.scope.performance&&P.scope.performance.now&&P.scope.performance.now()||Date.now(),u.propagationStopped=!1,u.immediatePropagationStopped=!1,u.defaultPrevented=!1,u.target=null,u.currentTarget=null,u.eventPhase=null,this}},{key:"stopPropagation",value:function(){k(this).propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){var e=k(this);e.propagationStopped=!0,e.immediatePropagationStopped=!0}},{key:"preventDefault",value:function(){this.cancelable&&(k(this).defaultPrevented=!0)}},{key:"type",get:function(){return k(this).type}},{key:"target",get:function(){return k(this).target}},{key:"currentTarget",get:function(){return k(this).currentTarget}},{key:"eventPhase",get:function(){return k(this).eventPhase}},{key:"captures",get:function(){return k(this).captures}},{key:"bubbles",get:function(){return k(this).bubbles}},{key:"cancelable",get:function(){return k(this).cancelable}},{key:"timeStamp",get:function(){return k(this).timeStamp}},{key:"propagationStopped",get:function(){return k(this).propagationStopped}},{key:"immediatePropagationStopped",get:function(){return k(this).immediatePropagationStopped}},{key:"defaultPrevented",get:function(){return k(this).defaultPrevented}}]),e}();function O(e){var t=k(e);return{set target(e){t.target=void 0!==e?e:null},set currentTarget(e){t.currentTarget=void 0!==e?e:null},set eventPhase(e){t.eventPhase=void 0!==e?e:null}}}var _=function(e){function t(){return n(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,E),r(t,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.type,r=e.target,a=s(e,["type","target"]);return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,o({type:n},a)),O(this).target=void 0!==r?r:null,this}}]),t}(),w=function(e){function t(){return n(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,_),r(t,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.type,r=e.target,o=e.captures,a=void 0!==o&&o,u=e.bubbles,c=void 0!==u&&u,l=s(e,["type","target","captures","bubbles"]);i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,{type:n,target:r,captures:a,bubbles:c});for(var p=Object.keys(l),f=0;f<p.length;++f){var d=p[f];if({}.hasOwnProperty.call(this,d))throw new Error('Name "'+d+'" cannot be used for event property');this[d]=l[d]}return this}}]),t}(),L=v("EventDispatcherMixin");function S(e,t){if("function"==typeof t)t(e);else{if("function"!=typeof t.handleEvent)throw new Error("Listener is neither function nor event listener");t.handleEvent(e)}}var j,z,A,q,D=(z=d(A=function(e){return function(o){function i(){var e;n(this,i);for(var t=arguments.length,r=Array(t),o=0;o<t;o++)r[o]=arguments[o];var a=u(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(r)));return L(a).listeners={},a}return a(i,e),r(i,[{key:"addEventListener",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("function"!=typeof n&&"object"!==(void 0===n?"undefined":t(n)))throw new Error("Attempt to add non-function non-object listener");var o=L(this);void 0===o.listeners[e]&&(o.listeners[e]={bubble:[],capture:[]});var i=r?o.listeners[e].capture:o.listeners[e].bubble;i.includes(n)||i.push(n)}},{key:"removeEventListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=L(this);if(void 0!==r.listeners[e]){var o=n?r.listeners[e].capture:r.listeners[e].bubble,i=o.indexOf(t);-1!==i&&o.splice(i,1)}}},{key:"on",value:function(){return this.addEventListener.apply(this,arguments),this}},{key:"off",value:function(){return this.removeEventListener.apply(this,arguments),this}},{key:"once",value:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];var i=this;return this.addEventListener.apply(this,[e,function n(o){S(o,t),i.removeEventListener.apply(i,[e,n].concat(r))}].concat(r)),this}},{key:"dispatchEvent",value:function(e){var t=e;t instanceof E||(t=new w(e));var n=O(t);null===t.target&&(n.target=this),n.currentTarget=this;var r=L(this).listeners[t.type];if(void 0!==r){var o=t.eventPhase;if(!o||"target"===o||"capture"===o)for(var i=[].concat(c(r.capture)),a=0;a<i.length;++a)if(S(t,i[a]),t.immediatePropagationStopped)return;if(!o||"target"===o||"bubble"===o)for(var s=[].concat(c(r.bubble)),u=0;u<s.length;++u)if(S(t,s[u]),t.immediatePropagationStopped)return}}}]),i}()},function(e){var t=A(e);return t.prototype[p]=A[f],t}),Symbol.hasInstance&&!z.hasOwnProperty(Symbol.hasInstance)&&Object.defineProperty(z,Symbol.hasInstance,{value:function(e){for(var t=this[f];null!=e;){if(e.hasOwnProperty(p)&&e[p]===t)return!0;e=Object.getPrototypeOf(e)}return!1}}),d(j=z,function(e){var t=j[l];if(t||(t=j[l]=Symbol(j.name)),e.hasOwnProperty(t))return e[t];var n=j(e);return e[t]=n,n})),x=function(e){function t(){return n(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),t}((q=function(){return function e(){n(this,e)}}(),new h(q)).with(D)),I=v("DataLoader");function T(e,t){var n=I(e);t!==n.size&&(n.size=t,e.dispatchEvent({type:"size"}))}function C(e,t){var n=I(e);t!==n.progress&&(n.progress=t,e.dispatchEvent({type:"progress"}))}function M(e,t){var n=I(e);t!==n.determinate&&(n.determinate=t,e.dispatchEvent({type:"determinate"}))}var B=function(e){function t(e){n(this,t);var r=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),o=I(r);return o.request=null,void 0!==e?(o.url=e.url||e,o.size=e.size||0):(o.url=null,o.size=0),o.progress=0,o.determinate=!1,o.completed=!1,o.failed=!1,r.onInitialProgress=r.onInitialProgress.bind(r),r.onProgress=r.onProgress.bind(r),r.onLoadend=r.onLoadend.bind(r),r}return a(t,x),r(t,[{key:"load",value:function(){var e=this,t=I(this);return void 0!==t.promise?t.promise:null===this.url?Promise.reject(new Error("Attempt to load without url")):(t.promise=new Promise(function(n,r){var o=new XMLHttpRequest;o.addEventListener("progress",e.onInitialProgress,!1),o.addEventListener("progress",e.onProgress,!1),o.addEventListener("loadend",e.onLoadend,!1),o.open("get",e.url),t.request=o,t.resolve=n,t.reject=r,e.onBeforeLoading(o),o.send()}),t.promise)}},{key:"abort",value:function(){var e=I(this);void 0!==e.promise&&e.request.abort()}},{key:"onInitialProgress",value:function(e){var t=I(this),n=e.target;if(n.removeEventListener("progress",this.onInitialProgress,!1),!(n.status<200||n.status>=300)){if(0===t.size)if(e.lengthComputable)T(this,e.total);else T(this,+n.getResponseHeader("X-Decompressed-Content-Length")||0);0!==t.size&&M(this,!0)}}},{key:"onProgress",value:function(e){var t=I(this);t.determinate&&C(this,Math.min(1,e.loaded/t.size))}},{key:"onLoadend",value:function(e){var t=this,n=I(this),r=e.target;r.removeEventListener("progress",this.onInitialProgress,!1),r.removeEventListener("progress",this.onProgress,!1),r.removeEventListener("loadend",this.onLoadend,!1),n.determinate||M(this,!0),r.status>=200&&r.status<300?(C(this,1),Promise.resolve(this.onAfterLoading(r)).then(function(){n.completed=!0,n.resolve(r),t.dispatchEvent({type:"complete"})}).catch(function(e){n.failed=!0,n.reject(e),t.dispatchEvent({type:"error"})})):(n.failed=!0,n.reject(r.status),this.dispatchEvent({type:"error"}))}},{key:"onBeforeLoading",value:function(e){}},{key:"onAfterLoading",value:function(e){}},{key:"request",get:function(){return I(this).request}},{key:"url",get:function(){return I(this).url}},{key:"size",get:function(){return I(this).size}},{key:"progress",get:function(){return I(this).progress}},{key:"determinate",get:function(){return I(this).determinate}},{key:"completed",get:function(){return I(this).completed}},{key:"failed",get:function(){return I(this).failed}}]),t}(),R=function(e){function t(){return n(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,B),r(t,[{key:"onAfterLoading",value:function(e){var t=this;return new Promise(function(e,n){var r=document.createElement("script");r.type="text/javascript",r.src=t.url,r.onload=function(){e()},r.onerror=function(e){n(e)};var o=document.getElementsByTagName("script"),i=o[o.length-1];i.parentNode.insertBefore(r,i)})}}]),t}(),F=v("Loader");var N=function(e){function t(){n(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=F(e);r.determinate=!1,r.completed=!1,r.failed=!1,e.onSize=e.onSize.bind(e),e.onProgress=e.onProgress.bind(e),e.onDeterminate=e.onDeterminate.bind(e),e.onComplete=e.onComplete.bind(e),e.onError=e.onError.bind(e);for(var o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];return r.sequence=function e(t){return t.map(function(t){return Array.isArray(t)?e(t):t&&"function"==typeof t.load?t:(t.url||t).endsWith(".js")?new R(t):new B(t)})}(i),r.loaders=function e(t){return t.reduce(function(t,n){return Array.isArray(n)?t.concat(e(n)):(t.push(n),t)},[])}(r.sequence),r.loaders.forEach(function(t){t.addEventListener("size",e.onSize,!1),t.addEventListener("progress",e.onProgress,!1),t.addEventListener("determinate",e.onDeterminate,!1),t.addEventListener("complete",e.onComplete,!1),t.addEventListener("error",e.onError,!1)}),e}return a(t,x),r(t,[{key:"load",value:function(){var e=F(this);return void 0!==e.promise?e.promise:0===this.loaders.length?Promise.reject():(e.promise=this.constructor.loadSequentially(e.sequence),e.promise)}},{key:"abort",value:function(){var e=F(this);void 0!==e.promise&&e.loaders.forEach(function(e){e.abort()})}},{key:"onSize",value:function(e){e.target.removeEventListener("size",this.onSize,!1),this.dispatchEvent({type:"size"})}},{key:"onProgress",value:function(e){this.dispatchEvent({type:"progress"})}},{key:"onDeterminate",value:function(e){e.target.removeEventListener("determinate",this.onDeterminate,!1);var t=F(this),n=t.loaders.every(function(e){return e.determinate});n!==t.determinate&&(t.determinate=n,this.dispatchEvent({type:"determinate"}))}},{key:"onComplete",value:function(e){var t=F(this),n=t.loaders.every(function(e){return e.completed});n!==t.completed&&(t.completed=n,this.dispatchEvent({type:"complete"}))}},{key:"onError",value:function(e){var t=F(this),n=t.loaders.some(function(e){return e.failed});n!==t.failed&&(t.failed=n,this.dispatchEvent({type:"error"}),t.failed&&this.abort())}},{key:"loaders",get:function(){var e=F(this);return[].concat(c(e.loaders))}},{key:"size",get:function(){return F(this).loaders.reduce(function(e,t){return e+t.size},0)}},{key:"progress",get:function(){var e=F(this);if(0===this.size)return Math.min(1,e.loaders.reduce(function(t,n){return t+n.progress/e.loaders.length},0));var t=e.loaders.filter(function(e){return 0!==e.size}),n=t.reduce(function(e,t){return e+t.size},0)/t.length,r=n*e.loaders.length;return Math.min(1,e.loaders.reduce(function(e,t){return e+t.progress*(t.size||n)/r},0))}},{key:"determinate",get:function(){return F(this).determinate}},{key:"completed",get:function(){return F(this).completed}},{key:"failed",get:function(){return F(this).failed}}],[{key:"loadParallelly",value:function(e){var t=this;return Promise.all(e.map(function(e){return Array.isArray(e)?t.loadSequentially(e):e.load().then(function(e){return[].concat(e)})})).then(function(e){var t;return(t=[]).concat.apply(t,c(e))})}},{key:"loadSequentially",value:function(e){var t=this;return 0===e.length?Promise.resolve([]):e.reduce(function(e,n){return null===e?Array.isArray(n)?t.loadParallelly(n):n.load().then(function(e){return[].concat(e)}):Array.isArray(n)?e.then(function(e){return t.loadParallelly(n).then(function(t){return[].concat(e,t)})}):e.then(function(e){return n.load().then(function(t){return[].concat(e,t)})})},null)}}]),t}();e.DataLoader=B,e.Loader=N,e.ScriptLoader=R,Object.defineProperty(e,"__esModule",{value:!0})});